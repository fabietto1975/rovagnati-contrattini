<?php

namespace backend\app\dao;

use backend\common\dao\DAOAbstract;
use backend\common\dao\DAOInterface;

class RilevazioneDAO extends DAOAbstract implements DAOInterface {

    public function __construct() {
        parent::__construct();
    } 

    public function create($item) {
        //NOP
    }

    public function delete($id) {
        //NOP
    }

    public function readByID($id) {
        //NOP
    }

    public function readRilevazioneInCorso() {
        $stmt = $this->getPdo()->prepare("
            SELECT 
                s.id,s.data_inizio, s.data_fine, f.id as id_famiglia, f.desc_famiglia as descrizione_famiglia
            FROM
                survey_rilevazione s
                    JOIN
                anagrafica_famiglia_prodotto f ON (f.ID = ID_FAMIGLIA)
            WHERE
                s.data_inizio <= SYSDATE()
                    AND s.data_fine >= SYSDATE();");
        $stmt->execute();
        return $stmt->fetchAll();
    }

    public function readRilevazione($id_rilevazione, $id_punto_vendita){
        $stmt = $this->getPdo()->prepare(""
                . "SELECT * FROM v_survey_scheda_rilevazione s "
                . "WHERE s.id_rilevazione = :id_rilevazione "
                . " and s.id_cliente= :id_punto_vendita"
                . " order by ORDINE_PRODOTTO");
        
        $stmt->bindParam('id_rilevazione',$id_rilevazione);
        $stmt->bindParam('id_punto_vendita',$id_punto_vendita);
        $stmt->execute();
        return $stmt->fetchAll();
    }

    public function update($item) {
        //NOP
    }

    public function read() {
        
    }

}
