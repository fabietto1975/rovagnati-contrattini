<?php

namespace backend\app\service;

use backend\app\dao\ContrattinoDAO;
use backend\app\dao\ListinoDAO;

class ContrattinoService {

    private $contrattinoDAO;
    private $listinoDAO;
    
    public function __construct() {
        $this->contrattinoDAO = new ContrattinoDAO();
        $this->listinoDAO = new ListinoDAO();
    }
    
        
    public function readByUser($id_user){
        $res = $this->contrattinoDAO->readByUser($id_user);
        if ($res==null){
            return array(
                'status' => 'fail',
                'message' => 'nessun contrattino trovato',
                'error' => 'NO_DATA'
            );
        } 
        return array(
            'res' => $res,
            'status' => 'success'
        );

    }
    
    public function readById($id){
        $res = $this->contrattinoDAO->readByID($id);
        if ($res==null){
            return array(
                'status' => 'fail',
                'message' => 'nessun contrattino trovato',
                'error' => 'NO_DATA'
            );
        } 
        return array(
            'res' => $res,
            'status' => 'success'
        );

    }
    
    public function create($contrattino){
        $res = $this->contrattinoDAO->create($contrattino);
        return array(
            'status' => 'success',
            'res' => $res
        );
    }

    public function update($contrattino){
        $res = $this->contrattinoDAO->update($contrattino);
        return array(
            'status' => 'success',
            'res' => $res
        );
    }
    
    public function calcolaSconto($tipoobbiettivo,$idprodotto,$obbiettivo,$premio){
        $listino = $this->listinoDAO->readByID($idprodotto)[0];
        if($tipoobbiettivo==1){
            /* eur/kg */
            return $premio;
        } else if($tipoobbiettivo==2){
            /* importofisso */
            return $listino['prezzolistino']-$premio;
        } else if($tipoobbiettivo==3){
            /* eur/pezzo */
            return ($listino['prezzolistino']- (($listino['prezzolistino']*$listino['pesomedio'])-$premio)/$listino['pesomedio'] );
        } else if($tipoobbiettivo==4){
            /* eur/cartone */
            return $listino['prezzolistino']-( (($listino['prezzolistino'] * $listino['pezzicartone'] *  $listino['pesomedio'])-$premio) / ($listino['pesomedio'] * $listino['pezzicartone'] ));
        } else if($tipoobbiettivo==5){
            /* % sconto */
            return ($premio/100)*$listino['prezzolistino'];
        } 
        
    }    

}
