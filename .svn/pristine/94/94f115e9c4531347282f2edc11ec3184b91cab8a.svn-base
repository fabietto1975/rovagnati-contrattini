<?php

namespace backend\app\dao;

use backend\common\dao\DAOAbstract;
use backend\common\dao\DAOInterface;

class SurveyDAO extends DAOAbstract implements DAOInterface {

    public function __construct() {
        parent::__construct();
    } 

    public function create($item) {
        //NOP
    }

    public function delete($id) {
        //NOP
    }

    public function read() {
    }

    public function update($item) {
         //NOP
    }
  
    public function readWaveCorrente() {
        $sql = "SELECT *
                FROM survey_wave
                WHERE DATA_INIZIO <= NOW() AND DATA_FINE > NOW()";
        
        $stmt = $this->getPdo()->prepare($sql);
        $stmt->execute();
        return $stmt->fetchAll();
    }
    
    public function readDomandeCliente($id_profilo, $id_wave, $id_cliente) {       
        $sql = "SELECT D.*
                FROM survey_domanda D LEFT JOIN survey_wave_domanda W ON D.ID = W.ID_DOMANDA
                WHERE D.ID_PROFILO = :id_profilo AND W.ID_WAVE = :id_wave 
                    AND d.id not in (select id_domanda from survey_risposta where id_cliente = :id_cliente) ";
        
        $stmt = $this->getPdo()->prepare($sql);
        $stmt->bindParam('id_profilo', $id_profilo);
        $stmt->bindParam('id_wave', $id_wave);
        $stmt->bindParam('id_cliente', $id_cliente);
        $stmt->execute();
        return $stmt->fetchAll();
    }
    
    public function readRisposteCliente($id_cliente) {       
        $sql = "SELECT *
                FROM survey_risposta
                WHERE ID_CLIENTE = :id_cliente";
        
        $stmt = $this->getPdo()->prepare($sql);
        $stmt->bindParam('id_cliente', $id_cliente);
        $stmt->execute();
        return $stmt->fetchAll();
    }

    public function readByID($id) {       
        $sql = "SELECT *
                FROM survey_risposta
                WHERE ID = :id";
        
        $stmt = $this->getPdo()->prepare($sql);
        $stmt->bindParam('id', $id);
        $stmt->execute();
        return $stmt->fetchAll();
    }

}
